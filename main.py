import streamlit as st
from datetime import date

st.set_page_config(page_title="ç°¡æ˜“ãƒ•ã‚©ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼", page_icon="ğŸ“·", layout="centered")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 0. ã‚¹ãƒ†ãƒ¼ãƒˆåˆæœŸåŒ–
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if "step" not in st.session_state:
    st.session_state.step = "basic"   # basic â†’ consent â†’ upload â†’ done
    st.session_state.basic = {}
    st.session_state.summary = {}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1. åŸºæœ¬æƒ…å ±å…¥åŠ›
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if st.session_state.step == "basic":
    st.markdown("## åŸºæœ¬æƒ…å ±ã®å…¥åŠ›ç”»é¢")

    with st.form("basic_form", clear_on_submit=False):
        dob = st.date_input("ç”Ÿå¹´æœˆæ—¥", value=date(2000, 1, 1), format="YYYY-MM-DD")
        gender = st.radio("æ€§åˆ¥", ["ç”·æ€§", "å¥³æ€§", "ãã®ä»–"])
        submitted = st.form_submit_button("æ¬¡ã¸ â–¶ï¸")

    if submitted:
        st.session_state.basic = {"dob": dob.isoformat(), "gender": gender}
        st.session_state.step = "consent"
        st.rerun()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2. åŒæ„
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
elif st.session_state.step == "consent":
    st.markdown("## æƒ…å ±ã®å–ã‚Šæ‰±ã„ã«ã¤ã„ã¦ã®åŒæ„ç¢ºèªç”»é¢")
    st.write("""
    å½“ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸå†™çœŸã‚’ 30 æ—¥ä»¥å†…ã«è‡ªå‹•å‰Šé™¤ã—ã¾ã™ã€‚
    è©³ç´°ã¯ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
    """)
    agree = st.checkbox("ä¸Šè¨˜ã«åŒæ„ã—ã¾ã™ âœ…")

    if st.button("ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»é¢ â–¶ï¸", disabled=not agree):
        st.session_state.step = "upload"
        st.rerun()

    if st.button("æˆ»ã‚‹ â¬…ï¸"):
        st.session_state.step = "basic"
        st.rerun()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 3. ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
elif st.session_state.step == "upload":
    st.markdown("## ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰")
    st.info("â†“ä¸€æ—¦ãã®ã¾ã¾ã€Œå®Œäº†ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ï¼ˆé–‹ç™ºç”¨ï¼‰ã€‚")

    # è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã¹ã‚‹è¨­å®šã€‚ç©ºã§ã‚‚å¯ã€‚
    files = st.file_uploader("ç”»åƒã‚’é¸æŠï¼ˆè¤‡æ•°å¯ï¼‰", type=["jpg", "jpeg", "png"],
                             accept_multiple_files=True)

    if st.button("å®Œäº† âœ…"):
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒç„¡ã„ & é–‹ç™ºç”¨ â†’ ãƒ€ãƒŸãƒ¼
        if not files:
            st.session_state.summary = {"total": 10, "person": 3, "landscape": 5, "other": 2}
        else:
            # å®Ÿéš›ã«ã¯ã“ã“ã§ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãªã©ã‚’è¡Œã†
            st.session_state.summary = {
                "total": len(files),
                "person": 0,
                "landscape": 0,
                "other": len(files),  # ã“ã“ã§ã¯åˆ†é¡ã›ãšå…¨éƒ¨ã€Œãã®ä»–ã€ã«
            }
        st.session_state.step = "done"
        st.rerun()

    if st.button("æˆ»ã‚‹ â¬…ï¸"):
        st.session_state.step = "consent"
        st.rerun()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 4. å®Œäº†ç”»é¢
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
elif st.session_state.step == "done":
    s = st.session_state.summary
    st.success(f"å†™çœŸãŒ **{s['total']} æš** ã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ ğŸ‰")
    st.write(f"å†…è¨³ â‡’ äººç‰©ï¼š{s['person']} æšã€é¢¨æ™¯ï¼š{s['landscape']} æšã€ãã®ä»–ï¼š{s['other']} æš")

    col1, col2 = st.columns(2)
    with col1:
        st.button("äººç‰©ã®å†™çœŸã‚‚å«ã‚ã¦ã‚¢ãƒƒãƒ—ã™ã‚‹ï¼ˆé–‹ç™ºç”¨ï¼‰", use_container_width=True)
    with col2:
        st.button("äººç‰©ã®å†™çœŸä»¥å¤–ã‚’ã‚¢ãƒƒãƒ—ã™ã‚‹", use_container_width=True)

    st.markdown("---")
    if st.button("ã‚‚ã†ä¸€åº¦è©¦ã™ ğŸ”„"):
        for key in ("step", "basic", "summary"):
            st.session_state.pop(key, None)
        st.rerun()
